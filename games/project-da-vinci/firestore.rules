rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // 기본 거부
    match /{document=**} {
      allow read, write: if false;
    }

    // 게임 로그 (읽기 전용 - Cloud Function(Admin SDK)이 쓰기)
    match /gameLogs/{logId} {
      allow read: if request.auth != null;
      allow write: if false; // 클라이언트 쓰기 차단 (Admin SDK는 규칙 우회)
    }

    // 분석 데이터 (읽기 전용 - Cloud Function(Admin SDK)이 자동 집계)
    match /analytics/{docId} {
      allow read: if request.auth != null;
      allow write: if false; // 클라이언트 쓰기 차단 (Admin SDK는 규칙 우회)
    }

    // 게임 스케줄 설정 (마스터 계정만 수정 가능)
    match /gameSchedules/config {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
                      request.auth.token.email != null &&
                      // TODO: 마스터 계정 이메일로 교체 필요
                      request.auth.token.email in ['swh1182@neolab.net'];
    }
  }
}
